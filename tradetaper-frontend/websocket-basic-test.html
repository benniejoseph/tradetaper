<!DOCTYPE html>
<html>
<head>
    <title>Basic WebSocket Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>Basic WebSocket Connection Test</h1>
    <div id="log" style="font-family: monospace; white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto;"></div>
    <br>
    <button onclick="testBasicConnection()">Test Basic Connection</button>
    <button onclick="testNamespaceConnection()">Test Trades Namespace</button>
    <button onclick="clearLog()">Clear Log</button>

    <script>
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            logDiv.textContent = '';
        }
        
        function testBasicConnection() {
            log('ðŸ”„ Testing basic Socket.IO connection...');
            
            const socket = io('http://localhost:3001', {
                transports: ['polling', 'websocket'],
                timeout: 5000
            });
            
            socket.on('connect', () => {
                log('âœ… Basic connection successful! Socket ID: ' + socket.id);
                log('ðŸ“¡ Transport: ' + socket.io.engine.transport.name);
                socket.disconnect();
            });
            
            socket.on('connect_error', (error) => {
                log('âŒ Basic connection failed: ' + error.message);
            });
            
            socket.on('disconnect', (reason) => {
                log('ðŸ”Œ Disconnected: ' + reason);
            });
        }
        
        function testNamespaceConnection() {
            log('ðŸ”„ Testing /trades namespace connection...');
            
            // Use a fresh test token
            const testToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImRlbW91c2VyQHRyYWRldGFwZXIuY29tIiwic3ViIjoiYjNhZjY5N2UtOWJjYS00NDFlLWFkZjEtZWE1Mjc1YWNjMzBmIiwiaWF0IjoxNzUzMTE5MjkzLCJleHAiOjE3NTMyMDU2OTN9.YF86tyk6pZ6U1yf1sZlgyokc9RE0r6JFNLN7V08hR8w';
            
            const socket = io('http://localhost:3001/trades', {
                transports: ['polling', 'websocket'],
                auth: { token: testToken },
                query: { token: testToken },
                timeout: 10000
            });
            
            socket.on('connect', () => {
                log('âœ… Namespace connection successful! Socket ID: ' + socket.id);
                log('ðŸ“¡ Transport: ' + socket.io.engine.transport.name);
            });
            
            socket.on('authenticated', (data) => {
                log('ðŸ” Authentication successful!');
                log('ðŸ‘¤ User: ' + JSON.stringify(data));
            });
            
            socket.on('connection-status', (data) => {
                log('ðŸ“Š Connection status: ' + JSON.stringify(data));
            });
            
            socket.on('connect_error', (error) => {
                log('âŒ Namespace connection failed: ' + error.message);
                log('ðŸ” Error type: ' + error.type);
                log('ðŸ” Error description: ' + error.description);
            });
            
            socket.on('error', (error) => {
                log('âŒ Socket error: ' + JSON.stringify(error));
            });
            
            socket.on('disconnect', (reason) => {
                log('ðŸ”Œ Disconnected from namespace: ' + reason);
            });
            
            // Test sending a message after connection
            setTimeout(() => {
                if (socket.connected) {
                    socket.emit('test-message', { message: 'Hello from test!' });
                    log('ðŸ“¤ Sent test message');
                }
            }, 2000);
        }
        
        log('ðŸš€ Basic WebSocket test ready.');
        log('ðŸ’¡ Try "Test Basic Connection" first, then "Test Trades Namespace"');
    </script>
</body>
</html> 